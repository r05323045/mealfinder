(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3fba5f3d"],{"0c6a":function(t,e,a){},"5cbe":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"purchase-page"},[a("Navbar"),a("div",{staticClass:"purchase-container"},[a("div",{staticClass:"title"},[t._v("我的購買")]),a("div",{staticClass:"purchase-wrapper"},[a("div",{staticClass:"tab-container"},[a("div",{staticClass:"tab ",class:{active:t.tabCart},on:{click:function(e){t.tabCart=!0}}},[t._v(" 購物車 "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.tabCart,expression:"tabCart"}],staticClass:"active-line"})]),a("div",{staticClass:"tab",class:{active:!t.tabCart},on:{click:function(e){t.tabCart=!1}}},[t._v(" 購買紀錄 "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.tabCart,expression:"!tabCart"}],staticClass:"active-line"})]),a("div",{staticClass:"divider"})]),a("div",{staticClass:"reservation-container"},[t.tabCart?a("Cart"):t._e(),t.tabCart?t._e():a("PastPurchase")],1)])]),a("div",{ref:"footer"},[a("Footer")],1)],1)},s=[],i=a("d178"),c=a("fd2d"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cart-page"},[a("div",{ref:"page-container",staticClass:"page-container"},[t.cart.length<1?a("div",{staticClass:"more-container"},[a("div",{staticClass:"more-title"},[t._v("還沒想好要買什麼？")]),a("div",{staticClass:"illustration-wrapper"},[a("div",{staticClass:"cover"},[a("div",{staticClass:"button",on:{click:function(e){return t.$router.push("/coupons")}}},[t._v("現在就去找餐券")])])])]):t._e(),t.cart.length>0?a("div",{staticClass:"purchase-card-wrapper"},[a("div",{staticClass:"purchase-card"},[a("div",{staticClass:"card-content"},t._l(t.cart,(function(e){return a("div",{key:e.id,staticClass:"item-wrapper"},[a("div",{staticClass:"icon close",on:{click:function(a){return t.deleteCart(e.id)}}}),a("div",{staticClass:"container"},[a("div",{staticClass:"image-container"},[a("div",{staticClass:"image-wrapper"},[a("div",{staticClass:"image",style:"background: url("+e.Coupon.picture+") no-repeat center / cover"})])]),e.Coupon?a("div",{staticClass:"name"},[t._v(t._s(e.Coupon.description))]):t._e(),a("div",{staticClass:"price-wrapper"},[a("div",{staticClass:"adjust-wrapper"},[a("div",{staticClass:"icon-wrapper",class:{equalOne:1===e.quantity}},[e.quantity>1?a("div",{staticClass:"icon minus",on:{click:function(a){return t.reduceCartItem(e.id)}}}):t._e()]),a("div",{staticClass:"number"},[t._v(t._s(e.quantity))]),a("div",{staticClass:"icon-wrapper"},[a("div",{staticClass:"icon plus",on:{click:function(a){return t.addCartItem(e.id)}}})])]),a("div",{staticClass:"price"},[t._v(t._s(t._f("priceFormat")(e.subTotalPrice)))])])]),a("div",{staticClass:"divider"})])})),0),a("div",{staticClass:"total-price-wrapper"},[a("div",{staticClass:"text"},[t._v("總計")]),a("div",{staticClass:"total-price"},[t._v(t._s(t._f("priceFormat")(t.totalPrice)))])])])]):t._e(),t.cart.length>0?a("div",{staticClass:"order-card-wrapper"},[a("div",{staticClass:"order-card"},[t._m(0),a("div",{staticClass:"divider"}),a("div",{staticClass:"card-content"},[a("div",{staticClass:"item-wrapper"},[a("div",{staticClass:"text"},[t._v("商品總計")]),a("div",{staticClass:"total-price"},[t._v(t._s(t._f("priceFormat")(t.totalPrice)))])]),a("div",{staticClass:"item-wrapper"},[a("div",{staticClass:"text"},[t._v("數量總計")]),a("div",{staticClass:"total-price"},[t._v(t._s(t.totalQuantity))])]),t._e(),a("div",{staticClass:"divider"}),a("div",{staticClass:"item-wrapper summary"},[a("div",{staticClass:"text"},[t._v("結帳總金額")]),a("div",{staticClass:"total-price"},[t._v(t._s(t._f("priceFormat")(t.totalPrice)))])])]),a("div",{staticClass:"go-check"},[a("div",{staticClass:"button-wrapper",on:{click:function(e){return t.$router.push("/users/checkout")}}},[a("div",{staticClass:"button"},[t._v("前往結帳")])])])])]):t._e()])])},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"header"},[a("div",{staticClass:"title"},[t._v("訂單摘要")])])}],u=(a("4de4"),a("4160"),a("a9e3"),a("159b"),a("96cf"),a("1da1")),l=a("2fa3"),d=a("644d"),v={data:function(){return{cart:[],totalPrice:0,totalQuantity:0}},created:function(){this.fetchCart()},methods:{fetchCart:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var a,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.$loading.show({container:t.$refs["page-container"],opacity:1,isFullPage:!1}),e.prev=1,e.next=4,d["a"].getCart();case 4:r=e.sent,s=r.data,t.cart=s.data,t.calculateTotalPrice(),a.hide(),e.next=16;break;case 11:e.prev=11,e.t0=e["catch"](1),a.hide(),console.log(e.t0),l["a"].fire({icon:"error",title:"目前無法取得購物車資訊，請稍候"});case 16:case"end":return e.stop()}}),e,null,[[1,11]])})))()},calculateTotalPrice:function(){var t=this;this.totalPrice=0,this.totalQuantity=0,this.cart.forEach((function(e){e.subTotalPrice=e.quantity*Number(e.Coupon.price),t.totalPrice+=Number(e.subTotalPrice),t.totalQuantity+=Number(e.quantity)}))},deleteCart:function(t){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,d["a"].deleteCart(t);case 3:if(r=a.sent,s=r.data,"success"===s.status){a.next=7;break}throw new Error(s.message);case 7:e.cart=e.cart.filter((function(e){return e.id!==t})),e.calculateTotalPrice(),l["a"].fire({icon:"success",title:"已移除商品"}),a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](0),console.log(a.t0),l["a"].fire({icon:"error",title:"目前無法移除商品，請稍後"});case 16:case"end":return a.stop()}}),a,null,[[0,12]])})))()},addCartItem:function(t){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,d["a"].addCartItem(t);case 3:if(r=a.sent,s=r.data,"success"===s.status){a.next=7;break}throw new Error(s.message);case 7:e.cart.forEach((function(e){e.id===t&&(e.quantity+=1)})),e.calculateTotalPrice(),a.next=15;break;case 11:a.prev=11,a.t0=a["catch"](0),console.log(a.t0),l["a"].fire({icon:"error",title:"目前無法增加數量，請稍後"});case 15:case"end":return a.stop()}}),a,null,[[0,11]])})))()},reduceCartItem:function(t){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,d["a"].reduceCartItem(t);case 3:if(r=a.sent,s=r.data,"success"===s.status){a.next=7;break}throw new Error(s.message);case 7:e.cart.forEach((function(e){e.id===t&&(e.quantity-=1)})),e.calculateTotalPrice(),a.next=15;break;case 11:a.prev=11,a.t0=a["catch"](0),console.log(a.t0),l["a"].fire({icon:"error",title:"目前無法增加數量，請稍後"});case 15:case"end":return a.stop()}}),a,null,[[0,11]])})))()}}},p=v,C=(a("88b7"),a("2877")),f=Object(C["a"])(p,n,o,!1,null,null,null),h=f.exports,m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"past-purchase",staticClass:"past-purchase"},[t.orders.length<1?a("div",{staticClass:"more-container"},[a("div",{staticClass:"more-title"},[t._v("從來沒買過？")]),a("div",{staticClass:"illustration-wrapper"},[a("div",{staticClass:"cover"},[a("div",{staticClass:"button",on:{click:function(e){return t.$router.push("/coupons")}}},[t._v("現在就去找餐券")])])])]):t._e(),t._l(t.orders,(function(e){return a("div",{key:e.id,staticClass:"purchase-card"},[a("div",{staticClass:"header"},[a("div",{staticClass:"title"},[t._v("在 "+t._s(t._f("normalDate")(e.createdAt))+" 的購買")]),a("div",{staticClass:"text",on:{click:function(a){return t.$router.push("/users/purchase/"+e.id)}}},[t._v("看詳細")])]),e.OrderItem?a("div",{staticClass:"card-content"},t._l(e.OrderItem,(function(e){return a("div",{key:e.id,staticClass:"item-wrapper"},[e.Coupon?a("div",{staticClass:"count-wrapper"},[a("div",{staticClass:"image-container"},[a("div",{staticClass:"image-wrapper"},[a("div",{staticClass:"image",style:"background: url("+e.Coupon.picture+") no-repeat center / cover"})])]),a("div",{staticClass:"name"},[t._v(t._s(e.Coupon.description))]),a("div",{staticClass:"count"},[a("div",{staticClass:"text"},[t._v("x"+t._s(e.quantity))])])]):t._e(),a("div",{staticClass:"divider"})])})),0):t._e(),a("div",{staticClass:"total-price-wrapper"},[a("div",{staticClass:"text"},[t._v("總計")]),a("div",{staticClass:"total-price"},[t._v(t._s(t._f("priceFormat")(e.totalPrice)))])])])}))],2)},_=[],b=a("5530"),w=a("2f62"),g={data:function(){return{orders:[]}},created:function(){this.fetchOrders()},computed:Object(b["a"])({},Object(w["b"])(["currentUser","isAuthenticated"])),methods:{fetchOrders:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var a,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.$loading.show({container:t.$refs["past-purchase"],opacity:1,isFullPage:!1}),e.prev=1,e.next=4,d["a"].getOrders();case 4:r=e.sent,s=r.data,t.orders=s.orders,t.orders.forEach((function(t){var e=0;t.OrderItem.forEach((function(t){e+=t.quantity*Number(t.Coupon.price)})),t.totalPrice=e})),a.hide(),e.next=16;break;case 11:e.prev=11,e.t0=e["catch"](1),a.hide(),console.log(e.t0),l["a"].fire({icon:"error",title:"目前無法取得所有歷史訂單"});case 16:case"end":return e.stop()}}),e,null,[[1,11]])})))()}}},k=g,x=(a("e09a"),Object(C["a"])(k,m,_,!1,null,null,null)),P=x.exports,y={data:function(){return{tabCart:!0}},components:{Navbar:i["a"],Footer:c["default"],Cart:h,PastPurchase:P},mounted:function(){}},O=y,I=(a("6114"),Object(C["a"])(O,r,s,!1,null,null,null));e["default"]=I.exports},6114:function(t,e,a){"use strict";a("6976")},"644d":function(t,e,a){"use strict";var r=a("2fa3"),s=function(){return localStorage.getItem("token")};e["a"]={getCart:function(){return r["b"].get("/user/cart",{headers:{Authorization:"Bearer ".concat(s())}})},postCart:function(t){return r["b"].post("/user/cart",t,{headers:{Authorization:"Bearer ".concat(s())}})},deleteCart:function(t){return r["b"].delete("/user/cart/".concat(t),{headers:{Authorization:"Bearer ".concat(s())}})},addCartItem:function(t){return r["b"].post("/user/cartItem/".concat(t,"/add"),{headers:{Authorization:"Bearer ".concat(s())}})},reduceCartItem:function(t){return r["b"].post("/user/cartItem/".concat(t,"/reduce"),{headers:{Authorization:"Bearer ".concat(s())}})},postTradeInfo:function(t){return r["b"].post("/user/order",t,{headers:{Authorization:"Bearer ".concat(s())}})},getOrders:function(){return r["b"].get("/order",{headers:{Authorization:"Bearer ".concat(s())}})},getOrder:function(t){return r["b"].get("/order/".concat(t),{headers:{Authorization:"Bearer ".concat(s())}})}}},6976:function(t,e,a){},"88b7":function(t,e,a){"use strict";a("8f4f")},"8f4f":function(t,e,a){},e09a:function(t,e,a){"use strict";a("0c6a")}}]);
//# sourceMappingURL=chunk-3fba5f3d.ba0ab41e.js.map