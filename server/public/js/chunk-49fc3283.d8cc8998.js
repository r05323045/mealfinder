(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49fc3283"],{"001e":function(t,e,a){t.exports=a.p+"img/phone.b027e13f.svg"},"2b83":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"reservation-page"},[a("Navbar"),a("div",{staticClass:"reservation-container"},[a("div",{staticClass:"main-title"},[t._v("在 "+t._s(t._f("bookingDateFormat")(t.reservation.updatedAt))+" 的訂位紀錄")]),a("div",{staticClass:"info-and-comment"},[a("div",{staticClass:"information-container"},[a("div",{staticClass:"information-body"},[a("div",{staticClass:"item-wrapper"},[t._m(0),a("div",{staticClass:"content"},[t._v(t._s(t.reservation.Restaurant_name))])]),a("div",{staticClass:"item-wrapper"},[t._m(1),t.reservation.date&&t.reservation.time?a("div",{staticClass:"content"},[t._v(" "+t._s(t._f("bookingDateFormat")(new Date(new Date(t.reservation.date.slice(0,10)).toDateString())))+" "+t._s(t.reservation.time.slice(0,5))+" "),new Date(new Date(t.reservation.date.slice(0,10)).toDateString())<Date.now()?a("span",{staticClass:"complete"},[t._v("已完成")]):t._e()]):t._e()]),a("div",{staticClass:"item-wrapper"},[t._m(2),a("div",{staticClass:"content"},[t._v(t._s(t.reservation.partySize_adult)+"大"),t.reservation.partySize_kids>0?a("span",[t._v("小")]):t._e()])]),a("div",{staticClass:"item-wrapper"},[t._m(3),a("div",{staticClass:"content"},[a("span",{staticClass:"name"},[t._v(t._s(t.reservation.UserName))]),a("span",{staticClass:"gender"},[t._v(t._s(t.genderTW))])])]),a("div",{staticClass:"item-wrapper"},[t._m(4),a("div",{staticClass:"content"},[t._v(t._s(t.reservation.email))])]),a("div",{staticClass:"item-wrapper"},[t._m(5),a("div",{staticClass:"content"},[t._v(t._s(t.reservation.phone))])]),a("div",{staticClass:"item-wrapper"},[t._m(6),a("div",{staticClass:"content"},[t._v(t._s(t.reservation.purpose))])]),a("div",{staticClass:"item-wrapper last"},[t._m(7),a("div",{staticClass:"content"},[t._v(t._s(t.reservation.note?t.reservatio.note:"無"))])])])]),a("div",{staticClass:"comment-card-wrapper"},[t.comments.map((function(t){return t.UserId})).includes(t.currentUser.id)?t._e():a("div",{staticClass:"comment-card"},[a("form",[a("validation-observer",{ref:"formvalidation",scopedSlots:t._u([{key:"default",fn:function(e){var s=e.invalid;return[a("div",{staticClass:"header"},[a("div",{staticClass:"title"},[t._v("填寫評論")])]),a("div",{staticClass:"divider"}),a("div",{staticClass:"card-content"},[a("div",{staticClass:"user-info-wrapper"},[a("div",{staticClass:"avatar",style:"background: url("+t.currentUser.avatar+") no-repeat center / cover"}),a("div",{staticClass:"user-info"},[a("div",{staticClass:"name"},[t._v(t._s(t.currentUser.name))]),a("div",{staticClass:"time"},[t._v(t._s(t._f("normalDate")(new Date)))])])]),a("div",{staticClass:"rating-container"},[a("div",{staticClass:"star-wrapper"},t._l(5,(function(e){return a("div",{key:"star-"+e,staticClass:"star",class:{rated:e<=t.rated},on:{click:function(a){return t.rating(e)}}})})),0),a("div",{staticClass:"text"},[t._v("點擊評分")]),t.rated<1&&t.firstClickSubmit?a("span",{staticClass:"invalid-text"},[t._v("評分為必填")]):t._e()]),a("validation-provider",{attrs:{rules:"required|max:140"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors,r=e.classes;return[a("div",{staticClass:"text-container"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentText,expression:"commentText"}],staticClass:"all-input text-area",class:t.firstClickSubmit?r:"",attrs:{type:"text",id:"comment-text",placeholder:"填寫你最真實的感受"},domProps:{value:t.commentText},on:{input:function(e){e.target.composing||(t.commentText=e.target.value)}}}),a("div",{staticClass:"note-count"},[t._v("("+t._s(t.commentText.length)+"/140)")]),t.firstClickSubmit&&0===t.commentText.length?a("span",{staticClass:"invalid-text comment-text"},[t._v("評論為必填")]):t._e(),t.firstClickSubmit&&s[0]?a("span",{staticClass:"invalid-text comment-text"},[t._v(t._s(s[0].replace("comment-text ","評論")))]):t._e()])]}}],null,!0)})],1),t.reservation.date?a("div",{staticClass:"write-comment"},[new Date(new Date(t.reservation.date.slice(0,10)).toDateString())<Date.now()?a("button",{staticClass:"button-wrapper",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.submitComment(s||t.rated<1)}}},[a("div",{staticClass:"button"},[t._v("填寫評論")])]):t._e(),new Date(new Date(t.reservation.date.slice(0,10)).toDateString())>=Date.now()?a("button",{staticClass:"button-wrapper disabled",attrs:{type:"submit",disabled:s}},[a("div",{staticClass:"button"},[t._v("尚未用餐")])]):t._e()]):t._e()]}}],null,!1,3061988081)})],1)]),t.comments.map((function(t){return t.UserId})).includes(t.currentUser.id)?a("div",{staticClass:"comment-card"},[a("form",[a("validation-observer",{ref:"formvalidation",scopedSlots:t._u([{key:"default",fn:function(e){var s=e.invalid;return[a("div",{staticClass:"header"},[a("div",{staticClass:"title"},[a("span",[t._v("在 "+t._s(t._f("normalDateWithoutYear")(new Date(new Date(t.comment.updatedAt.slice(0,10)).toDateString())))+" 的評論")]),a("span",{staticClass:"delete",on:{click:t.deleteComment}},[t._v("刪除")])])]),a("div",{staticClass:"divider"}),a("div",{staticClass:"card-content"},[a("div",{staticClass:"user-info-wrapper"},[a("div",{staticClass:"avatar",style:"background: url("+t.currentUser.avatar+") no-repeat center / cover"}),a("div",{staticClass:"user-info"},[a("div",{staticClass:"name"},[t._v(t._s(t.currentUser.name))]),a("div",{staticClass:"time"},[t._v(t._s(t._f("normalDate")(new Date(new Date(t.comment.updatedAt.slice(0,10)).toDateString()))))])])]),a("div",{staticClass:"rating-container"},[a("div",{staticClass:"star-wrapper"},t._l(5,(function(e){return a("div",{key:"star-"+e,staticClass:"star",class:{rated:e<=t.rated},on:{click:function(a){return t.rating(e)}}})})),0),a("div",{staticClass:"text"},[t._v("點擊評分")]),t.rated<1&&t.firstClickSubmit?a("span",{staticClass:"invalid-text"},[t._v("評分為必填")]):t._e()]),a("validation-provider",{attrs:{rules:"required|max:140"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors,r=e.classes;return[a("div",{staticClass:"text-container"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentText,expression:"commentText"}],staticClass:"all-input text-area",class:r,attrs:{type:"text",id:"comment-text",placeholder:"填寫你最真實的感受"},domProps:{value:t.commentText},on:{input:function(e){e.target.composing||(t.commentText=e.target.value)}}}),a("div",{staticClass:"note-count"},[t._v("("+t._s(t.commentText.length)+"/140)")]),t.firstClickSubmit&&0===t.commentText.length?a("span",{staticClass:"invalid-text comment-text"},[t._v("評論為必填")]):t._e(),t.firstClickSubmit&&s[0]?a("span",{staticClass:"invalid-text comment-text"},[t._v(t._s(s[0].replace("comment-text ","評論")))]):t._e()])]}}],null,!0)})],1),t.reservation.date?a("div",{staticClass:"write-comment"},[a("button",{staticClass:"button-wrapper",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.changeComment(s||t.rated<1)}}},[a("div",{staticClass:"button"},[t._v("變更評論")])])]):t._e()]}}],null,!1,51215254)})],1)]):t._e()])])]),a("div",{ref:"footer"},[a("Footer")],1)],1)},r=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[s("img",{staticClass:"icon restaurant",attrs:{src:a("5d27")}}),s("div",{staticClass:"title"},[t._v("餐廳名稱")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[s("img",{staticClass:"icon clock",attrs:{src:a("e0f8")}}),s("div",{staticClass:"title"},[t._v("用餐時間")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[s("img",{staticClass:"icon profile",attrs:{src:a("b855")}}),s("div",{staticClass:"title"},[t._v("訂位人數")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[s("img",{staticClass:"icon profile",attrs:{src:a("b855")}}),s("div",{staticClass:"title"},[t._v("訂位人姓名")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[s("img",{staticClass:"icon email",attrs:{src:a("9055")}}),s("div",{staticClass:"title"},[t._v("訂位人Email")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[s("img",{staticClass:"icon phone",attrs:{src:a("001e")}}),s("div",{staticClass:"title"},[t._v("訂位人手機")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[s("img",{staticClass:"icon map",attrs:{src:a("a086")}}),s("div",{staticClass:"title"},[t._v("用餐目的")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[s("img",{staticClass:"icon restaurant",attrs:{src:a("5d27")}}),s("div",{staticClass:"title"},[t._v("其他備註")])])}],n=(a("4de4"),a("caad"),a("d81d"),a("2532"),a("96cf"),a("1da1")),i=a("5530"),c=a("2fa3"),o=a("2f62"),l=a("6d7f"),m=function(){return localStorage.getItem("token")},u={getComments:function(t){return c["b"].get("/comments/".concat(t),{headers:{Authorization:"Bearer ".concat(m())}})},addComment:function(t){return c["b"].post("/comments",t,{headers:{Authorization:"Bearer ".concat(m())}})},updateComment:function(t,e){return c["b"].put("/comments/".concat(t),e,{headers:{Authorization:"Bearer ".concat(m())}})},deleteComment:function(t){return c["b"].delete("/comments/".concat(t),{headers:{Authorization:"Bearer ".concat(m())}})}},d=a("d178"),v=a("fd2d"),p={data:function(){return{tabFuture:!0,rated:-1,commentText:"",reservation:{},genderTW:"先生",firstClickSubmit:!1,comments:[],comment:{}}},components:{Navbar:d["a"],Footer:v["default"]},created:function(){this.fetchReservation(this.$route.params.id)},mounted:function(){},computed:Object(i["a"])({},Object(o["b"])(["currentUser","isAuthenticated"])),methods:{rating:function(t){this.rated=t},fetchReservation:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s,r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=e.$loading.show({isFullPage:!0,opacity:1}),a.prev=1,a.next=4,l["a"].getReservation(t);case 4:r=a.sent,n=r.data,e.reservation=n.reservation,a.t0=e.reservation.gender,a.next="female"===a.t0?10:"male"===a.t0?12:"other"===a.t0?14:16;break;case 10:return e.genderTW="小姐",a.abrupt("break",16);case 12:return e.genderTW="先生",a.abrupt("break",16);case 14:return e.genderTW="",a.abrupt("break",16);case 16:return a.next=18,u.getComments(e.reservation.RestaurantId);case 18:i=a.sent,e.comments=i.data.comments,e.comments.map((function(t){return t.UserId})).includes(e.currentUser.id)?(e.comment=e.comments.filter((function(t){return t.UserId===e.currentUser.id}))[0],e.rated=e.comment.rating,e.commentText=e.comment.content):(e.rated=-1,e.commentText="",e.firstClickSubmit=!1),s.hide(),a.next=29;break;case 24:a.prev=24,a.t1=a["catch"](1),s.hide(),console.log(a.t1),c["a"].fire({icon:"error",title:"目前無法取得餐廳，請稍候"});case 29:case"end":return a.stop()}}),a,null,[[1,24]])})))()},addComment:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a={content:t.commentText,rating:t.rated,RestaurantId:t.reservation.RestaurantId},e.next=4,u.addComment(a);case 4:if(s=e.sent,r=s.data,"success"===r.status){e.next=8;break}throw new Error(r.message);case 8:t.fetchReservation(t.$route.params.id),c["a"].fire({icon:"success",title:"評論成功"}),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](0),console.log(e.t0),c["a"].fire({icon:"error",title:"目前無法訂評論"});case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))()},updateComment:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a={content:t.commentText,rating:t.rated,RestaurantId:t.reservation.RestaurantId},e.next=4,u.updateComment(t.comment.id,a);case 4:if(s=e.sent,r=s.data,"success"===r.status){e.next=8;break}throw new Error(r.message);case 8:t.fetchReservation(t.$route.params.id),c["a"].fire({icon:"success",title:"變更評論成功"}),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](0),console.log(e.t0),c["a"].fire({icon:"error",title:"目前無法變更"});case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))()},deleteComment:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.deleteComment(t.comment.id);case 3:if(a=e.sent,s=a.data,"success"===s.status){e.next=7;break}throw new Error(s.message);case 7:t.fetchReservation(t.$route.params.id),c["a"].fire({icon:"success",title:"刪除評論成功"}),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),console.log(e.t0),c["a"].fire({icon:"error",title:"目前無法刪除"});case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()},submitComment:function(t){this.firstClickSubmit||(this.firstClickSubmit=!0),t||this.addComment()},changeComment:function(t){t||this.updateComment(),this.fetchReservation(this.$route.params.id)}}},f=p,C=(a("891c"),a("2877")),_=Object(C["a"])(f,s,r,!1,null,null,null);e["default"]=_.exports},"2d87":function(t,e,a){},"5d27":function(t,e,a){t.exports=a.p+"img/restaurant.64e7e302.svg"},"6d7f":function(t,e,a){"use strict";var s=a("2fa3"),r=function(){return localStorage.getItem("token")};e["a"]={getReservations:function(){return s["b"].get("/user/reservations",{headers:{Authorization:"Bearer ".concat(r())}})},getReservation:function(t){return s["b"].get("/user/reservations/".concat(t),{headers:{Authorization:"Bearer ".concat(r())}})},addReservation:function(t){return s["b"].post("/user/reservations",t,{headers:{Authorization:"Bearer ".concat(r())}})}}},"891c":function(t,e,a){"use strict";a("2d87")},9055:function(t,e,a){t.exports=a.p+"img/email.7a01161c.svg"},a086:function(t,e,a){t.exports=a.p+"img/map.b6a9f4f5.svg"},b855:function(t,e,a){t.exports=a.p+"img/profile.0f180f0a.svg"},e0f8:function(t,e,a){t.exports=a.p+"img/clock.8f8a9c12.svg"}}]);
//# sourceMappingURL=chunk-49fc3283.d8cc8998.js.map