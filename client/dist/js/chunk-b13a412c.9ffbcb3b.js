(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b13a412c"],{"1a34":function(e,t,a){e.exports=a.p+"img/calendar.e3c7d004.svg"},"3cc8":function(e,t,a){"use strict";a("6d43")},"5d27":function(e,t,a){e.exports=a.p+"img/restaurant.64e7e302.svg"},"6d43":function(e,t,a){},"6d7f":function(e,t,a){"use strict";var s=a("2fa3"),r=function(){return localStorage.getItem("token")};t["a"]={getReservations:function(){return s["b"].get("/user/reservations",{headers:{Authorization:"Bearer ".concat(r())}})},getReservation:function(e){return s["b"].get("/user/reservations/".concat(e),{headers:{Authorization:"Bearer ".concat(r())}})},addReservation:function(e){return s["b"].post("/user/reservations",e,{headers:{Authorization:"Bearer ".concat(r())}})}}},7138:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"booking",staticClass:"booking"},[s("Navbar",{directives:[{name:"show",rawName:"v-show",value:0===e.scrollY,expression:"scrollY === 0"}],staticClass:"restaurant-navbar"}),s("div",{staticClass:"booking-searchbar-wrapper"},[s("div",{staticClass:"back-wrapper",on:{click:function(t){return e.$router.go(-1)}}},[s("div",{staticClass:"icon back"})]),s("div",{staticClass:"searchbar"},[e._e(),s("div",{staticClass:"wrapper"},[s("div",{staticClass:"text"},[e._v(" "+e._s(e.restaurant.name)+" ")])])])]),s("form",{staticClass:"booking-form"},[s("div",{staticClass:"card-container"},[s("div",{staticClass:"card-container-title"},[e._v("確認訂位與填寫聯絡資訊")]),s("div",{staticClass:"booking-card-wrapper"},[s("div",{staticClass:"booking-card"},[s("div",{staticClass:"picture-wrapper"},[s("div",{staticClass:"picture",style:"background: url("+e.restaurant.picture+") no-repeat center; background-size: cover"})]),s("div",{staticClass:"header"},[s("img",{staticClass:"icon-restaurant",attrs:{src:a("5d27")}}),s("div",{staticClass:"name"},[e._v(e._s(e.restaurant.name))])]),s("div",{staticClass:"divider"}),s("div",{staticClass:"info"},[s("div",{staticClass:"item-wrapper"},[s("img",{staticClass:"icon profile",attrs:{src:a("b855")}}),s("div",{staticClass:"number"},[e._v(e._s(e.adultNum)+"大"),e.childNum>0?s("span",[e._v(e._s(e.childNum)+"小")]):e._e()])]),s("div",{staticClass:"item-wrapper"},[s("img",{staticClass:"icon time",attrs:{src:a("1a34")}}),s("div",{staticClass:"date"},[e._v(e._s(e._f("bookingDateFormat")(e.bookingDate)))])]),s("div",{staticClass:"item-wrapper"},[s("img",{staticClass:"icon time",attrs:{src:a("e0f8")}}),s("div",{staticClass:"time"},[e._v(e._s(e.bookingTime))])])])])]),s("div",{staticClass:"contact-card-wrapper"},[s("validation-observer",{ref:"formvalidation",scopedSlots:e._u([{key:"default",fn:function(t){var a=t.invalid;return[s("div",{staticClass:"title"},[e._v("確認訂位與填寫聯絡資訊")]),s("div",{staticClass:"contact-card"},[s("div",{staticClass:"all-wrapper"},[s("validation-provider",{attrs:{rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.errors,r=t.classes;return[s("label",{staticClass:"all-text",attrs:{for:"name"}},[e._v("訂位人姓名")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userName,expression:"userName"}],staticClass:"all-input",class:r,attrs:{id:"name",type:"text"},domProps:{value:e.userName},on:{input:function(t){t.target.composing||(e.userName=t.target.value)}}}),a[0]?s("span",{staticClass:"invalid-text"},[e._v(e._s(a[0].replace("name ","姓名")))]):e._e()]}}],null,!0)}),s("div",{staticClass:"gender"},[s("span",{staticClass:"item-wrapper"},[s("label",{staticClass:"item",attrs:{for:"gender-female"}},[s("span",{staticClass:"radio-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userGender,expression:"userGender"}],attrs:{name:"gender",id:"gender-female",role:"radio",value:"female",type:"radio",checked:""},domProps:{checked:e._q(e.userGender,"female")},on:{change:function(t){e.userGender="female"}}}),s("span",{staticClass:"radio-control"})]),s("span",{staticClass:"text"},[e._v("小姐")])])]),s("span",{staticClass:"item-wrapper"},[s("label",{staticClass:"item",attrs:{for:"gender-male"}},[s("span",{staticClass:"radio-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userGender,expression:"userGender"}],attrs:{name:"gender",id:"gender-male",role:"radio",value:"male",type:"radio"},domProps:{checked:e._q(e.userGender,"male")},on:{change:function(t){e.userGender="male"}}}),s("span",{staticClass:"radio-control"})]),s("span",{staticClass:"text"},[e._v("先生")])])]),s("span",{staticClass:"item-wrapper"},[s("label",{staticClass:"item",attrs:{for:"gender-other"}},[s("span",{staticClass:"radio-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userGender,expression:"userGender"}],attrs:{name:"gender",id:"gender-other",role:"radio",value:"other",type:"radio"},domProps:{checked:e._q(e.userGender,"other")},on:{change:function(t){e.userGender="other"}}}),s("span",{staticClass:"radio-control"})]),s("span",{staticClass:"text"},[e._v("其他")])])])])],1),s("div",{staticClass:"all-wrapper"},[s("validation-provider",{attrs:{rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.errors,r=t.classes;return[s("label",{staticClass:"all-text",attrs:{for:"phone"}},[e._v("訂位人手機號碼")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userPhone,expression:"userPhone"}],staticClass:"all-input",class:r,attrs:{id:"phone",type:"text"},domProps:{value:e.userPhone},on:{input:function(t){t.target.composing||(e.userPhone=t.target.value)}}}),a[0]?s("span",{staticClass:"invalid-text"},[e._v(e._s(a[0].replace("phone ","手機號碼")))]):e._e()]}}],null,!0)})],1),s("div",{staticClass:"all-wrapper"},[s("validation-provider",{attrs:{rules:"required|email"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.errors,r=t.classes;return[s("label",{staticClass:"all-text",attrs:{for:"email"}},[e._v("訂位人電子郵件")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userEmail,expression:"userEmail"}],staticClass:"all-input",class:r,attrs:{id:"email",type:"email"},domProps:{value:e.userEmail},on:{input:function(t){t.target.composing||(e.userEmail=t.target.value)}}}),a[0]?s("span",{staticClass:"invalid-text"},[e._v(e._s(a[0].replace("email ","電子郵件")))]):e._e()]}}],null,!0)})],1),s("div",{staticClass:"all-wrapper"},[s("label",{staticClass:"all-text",attrs:{for:"purpose"}},[e._v("用餐目的")]),s("div",{staticClass:"button-wrapper"},[e._l(e.purpose,(function(t,a){return s("button",{key:"purpose-"+a,staticClass:"button",class:{select:e.submitPurpose.includes(t)},on:{click:function(a){return a.preventDefault(),e.changePurpose(t)}}},[s("span",{staticClass:"text"},[e._v(e._s(t))])])})),!e.submitPurpose&&e.firstClickSubmit?s("span",{staticClass:"invalid-text"},[e._v("請選擇用餐目的")]):e._e()],2)]),s("div",{staticClass:"all-wrapper"},[s("validation-provider",{attrs:{rules:"max:140"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.errors,r=t.classes;return[s("label",{staticClass:"all-text",attrs:{for:"note"}},[e._v("其他備註")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.userNote,expression:"userNote"}],staticClass:"all-input text-area",class:r,attrs:{id:"note",placeholder:"有任何特殊需求嗎？可以先寫在這裡喔！（例如：行動不便、過敏）"},domProps:{value:e.userNote},on:{input:function(t){t.target.composing||(e.userNote=t.target.value)}}}),s("div",{staticClass:"note-count"},[e._v("("+e._s(e.userNote.length)+"/140)")]),a[0]?s("span",{staticClass:"invalid-text note-error"},[e._v(e._s(a[0].replace("note ","其他備註")))]):e._e()]}}],null,!0)})],1)]),s("div",{staticClass:"submit-button-wrapper"},[s("button",{staticClass:"submit-button",attrs:{type:"submit",disabled:a},on:{click:function(t){return t.preventDefault(),e.submitReservation(a||!e.submitPurpose)}}},[s("div",{staticClass:"button"},[e._v("確認訂位")])]),s("div",{staticClass:"back-button",on:{click:function(t){return t.preventDefault(),e.$router.go(-1)}}},[s("div",{staticClass:"button"},[e._v("回上一步")])])])]}}])})],1)])]),s("div",{ref:"footer"},[s("Footer")],1)],1)},r=[],i=(a("99af"),a("b0c0"),a("a9e3"),a("96cf"),a("1da1")),n=a("5530"),o=a("2fa3"),c=a("2f62"),l=a("c4c3"),u=a("6d7f"),d=a("d178"),p=a("fd2d"),m={data:function(){return{purpose:["慶生","約會","家庭聚餐","朋友聚餐","商務聚餐","其他"],submitPurpose:"",scrollY:0,scrollUp:!0,restaurant:{},restaurantId:0,bookingTime:"",bookingDate:new Date,adultNum:0,childNum:0,userName:"",userGender:"female",userPhone:"",userEmail:"",userNote:"",firstClickSubmit:!1}},components:{Footer:p["default"],Navbar:d["a"]},created:function(){this.restaurantId=this.$route.query.restaurant,this.adultNum=Number(this.$route.query.adult),this.childNum=Number(this.$route.query.child),this.bookingDate=new Date(Number(this.$route.query.date)),this.bookingTime=this.$route.query.time,this.fetchRestaurant(this.restaurantId),this.currentUser&&(this.userName=this.currentUser.name,this.userGender=this.currentUser.gender,this.userPhone=this.currentUser.phone_number,this.userEmail=this.currentUser.email)},mounted:function(){this.$refs.booking.addEventListener("scroll",this.onScroll,{passive:!0})},computed:Object(n["a"])({},Object(c["b"])(["currentUser","isAuthenticated"])),methods:{onScroll:function(e){this.scrollY=this.$refs.booking.scrollTop},changePurpose:function(e){this.submitPurpose=e},fetchRestaurant:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,!t.isAuthenticated){a.next=7;break}return a.next=4,l["a"].getUsersRestaurant(e);case 4:a.t0=a.sent,a.next=10;break;case 7:return a.next=9,l["a"].getRestaurant(e);case 9:a.t0=a.sent;case 10:s=a.t0,r=s.data,t.restaurant=r,a.next=19;break;case 15:a.prev=15,a.t1=a["catch"](0),console.log(a.t1),o["a"].fire({icon:"error",title:"目前無法取得餐廳，請稍候"});case 19:case"end":return a.stop()}}),a,null,[[0,15]])})))()},addReservation:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={date:e.bookingDate,time:e.bookingTime,partySize_adult:e.adultNum,partySize_kids:e.childNum,UserId:e.currentUser.id,RestaurantId:e.restaurantId,name:e.userName,gender:e.userGender,phone:e.userPhone,email:e.userEmail,purpose:e.submitPurpose,note:e.userNote},t.next=4,u["a"].addReservation(a);case 4:if(s=t.sent,r=s.data,"success"===r.status){t.next=8;break}throw new Error(r.message);case 8:o["a"].fire({icon:"success",title:"訂位成功"}),e.$router.push("/booking/success?restaurant=".concat(e.restaurantId,"&adult=").concat(e.adultNum,"&child=").concat(e.childNum,"&date=").concat(new Date(e.bookingDate).getTime(),"&time=").concat(e.bookingTime)).catch((function(){})),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](0),console.log(t.t0),o["a"].fire({icon:"error",title:"目前無法訂位"});case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))()},submitReservation:function(e){this.firstClickSubmit||(this.firstClickSubmit=!0),e||this.addReservation()}}},v=m,f=(a("3cc8"),a("2877")),h=Object(f["a"])(v,s,r,!1,null,null,null);t["default"]=h.exports},b0c0:function(e,t,a){var s=a("83ab"),r=a("9bf2").f,i=Function.prototype,n=i.toString,o=/^\s*function ([^ (]*)/,c="name";s&&!(c in i)&&r(i,c,{configurable:!0,get:function(){try{return n.call(this).match(o)[1]}catch(e){return""}}})},b855:function(e,t,a){e.exports=a.p+"img/profile.0f180f0a.svg"},e0f8:function(e,t,a){e.exports=a.p+"img/clock.8f8a9c12.svg"}}]);
//# sourceMappingURL=chunk-b13a412c.9ffbcb3b.js.map